<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.mapper.ReservationMapper">

    <!-- 예약 추가 -->
    <insert id="insertReservation" parameterType="com.reading_room_reservation.entity.Reservation">
        INSERT INTO reservations (user_id, seat_id, reserved_at, reserved_until)
        VALUES (#{userId}, #{seatId}, #{reservedAt}, #{reservedUntil})
    </insert>

    <!-- 예약 수정 -->
    <update id="updateReservation" parameterType="com.reading_room_reservation.entity.Reservation">
        UPDATE reservations
        SET reserved_until = #{reservedUntil}
        WHERE id = #{id}
    </update>

    <!-- 예약 삭제 -->
    <delete id="deleteReservation" parameterType="int">
        DELETE FROM reservations WHERE id = #{id}
    </delete>

    <!-- 특정 사용자의 예약 목록 조회 -->
    <select id="getUserReservations" resultType="com.reading_room_reservation.entity.Reservation" parameterType="int">
        SELECT * FROM reservations WHERE user_id = #{userId}
    </select>

    <!-- 사용자의 현재 활성 예약 조회 -->
    <select id="getActiveReservation" resultType="com.reading_room_reservation.entity.Reservation" parameterType="int">
        SELECT * FROM reservations
        WHERE user_id = #{userId}
          AND reserved_until > CURRENT_TIMESTAMP
            LIMIT 1
    </select>

</mapper>
